# Fermiumlabs
server {
	listen 80;
	listen [::]:80;
	listen 443 ssl;
	listen [::]:443 ssl ;

  #ssl        on;
  ssl_certificate         /var/www/certificates/cloudflare_fermiumlabs_com.pem;
  ssl_certificate_key     /var/www/certificates/cloudflare_fermiumlabs_com-key.pem;

	root /var/www/html/fermiumlabs/website/master/public_html/;

	# Add index.php to the list if you are using PHP
	index index.html;

	server_name fermiumlabs.com ~^srv\d+\.web.fermiumlabs\.com$;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ =404;
	}

	# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
	#
	#location ~ \.php$ {
	#	include snippets/fastcgi-php.conf;
	#
	#	# With php7.0-cgi alone:
	#	fastcgi_pass 127.0.0.1:9000;
	#	# With php7.0-fpm:
	#	fastcgi_pass unix:/var/run/php7.0-fpm.sock;
	#}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}
}

#redirect all not-known domains to fermiumlabs.com (including IPs)
server {
     listen 80 default_server;
     listen [::]:80 default_server;
     return 302 http://fermiumlabs.com; #temporary redirect 302
       }

#redirect WWW to non-WWW
 server {
    listen 10.19.0.12:80; #anchor to floating ip
    server_name  www.fermiumlabs.com;
    #rewrite ^(.*) $scheme://fermiumlabs.com$1 permanent; #keep http or https
    rewrite ^(.*) https://fermiumlabs.com$1 permanent;  #rewrite to https
  }
